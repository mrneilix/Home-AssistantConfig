#PRESENCE
  - platform: template
    sensors:
      anyone_home:
        value_template: >-
          {%- if is_state("device_tracker.neil", "home")
          or is_state("device_tracker.dad", "home")
          or is_state("device_tracker.mom", "home")
          or is_state("device_tracker.gina", "home")
              -%}
          True
          {%- else -%}
          False
          {%- endif %}
        entity_id:
          - device_tracker.neil
          - device_tracker.dad
          - device_tracker.mom
          - device_tracker.gina

      lock_code_entered:
        friendly_name: Lock Code Entered
        value_template: >-
          {% if (as_timestamp(now()) - as_timestamp(states.sensor.last_lock_code_name.last_updated) < 600 ) and (states('sensor.uptime') | int > 10) and is_state("lock.schlage_deadbolt_47", "unlocked") %}
            True
          {% else %}
            False
          {% endif %}
        entity_id:
          - sensor.last_lock_code_name
          - sensor.dark_sky_apparent_temperature

      neil_lock_code:
        friendly_name: Neil Lock Code
        value_template: >-
          {% if is_state("sensor.last_lock_code_name", "Neil") and is_state("binary_sensor.lock_code_entered", "on") %}
            True
          {% else %}
            False
          {% endif %}
        entity_id:
          - sensor.last_lock_code_name
          - sensor.dark_sky_apparent_temperature
          - binary_sensor.lock_code_entered

      parents_code:
        friendly_name: Parents Lock Code
        value_template: >-
          {% if is_state("sensor.last_lock_code_name", "Parents") and is_state("binary_sensor.lock_code_entered", "on") %}
            True
          {% else %}
            False
          {% endif %}
        entity_id:
          - sensor.last_lock_code_name
          - sensor.dark_sky_apparent_temperature
          - binary_sensor.lock_code_entered

      gina_code:
        friendly_name: Parents Lock Code
        value_template: >-
          {% if is_state("sensor.last_lock_code_name", "Gina") and is_state("binary_sensor.lock_code_entered", "on") %}
            True
          {% else %}
            False
          {% endif %}
        entity_id:
          - sensor.last_lock_code_name
          - sensor.dark_sky_apparent_temperature
          - binary_sensor.lock_code_entered

      presence_mqtt_pixel:
        friendly_name: Neil MQTT Pixel
        device_class: presence
        value_template: >-
          {%- if is_state("sensor.neil_mqtt_pixel", "unknown") or is_state("sensor.neil_mqtt_pixel", "0") %}
            False
          {%- else -%}
            True
          {%- endif %}
        entity_id:
          - sensor.neil_mqtt_pixel

      presence_mqtt_charge_2:
        friendly_name: Neil MQTT Fitbit
        device_class: presence
        value_template: >-
          {%- if is_state("sensor.neil_mqtt_charge_2", "unknown") or is_state("sensor.neil_mqtt_charge_2", "0") %}
            False
          {%- else -%}
            True
          {%- endif %}
        entity_id:
          - sensor.neil_mqtt_charge_2

      anyone_home_but_neil:
        friendly_name: Anyone Home But Neil
        value_template: >-
          {%- if is_state("device_tracker.neil", "home") %}
            False
          {%-elif is_state("device_tracker.gina", "home") %}
            True
          {%-elif is_state("device_tracker.parents", "home") %}
            True
          {%- else -%}
            False
          {%- endif %}
        entity_id:
          - binary_sensor.parents_code
          - binary_sensor.gina_code
          - device_tracker.neil
          - device_tracker.gina
          - device_tracker.parents

      butters_tile:
        friendly_name: Butters Tile
        device_class: presence
        value_template: >-
          {%- if not is_state("sensor.butters_mqtt_tile", "unknown") and not is_state("sensor.butters_mqtt_tile", "0") %}
            True
          {%- else -%}
            False
          {%- endif %}
        entity_id:
          - sensor.butters_mqtt_tile

# Dark Outside
      dark_out:
        friendly_name: Dark Outside
        value_template: >-
          {% if states('sensor.illuminance') | int < 5500 %}
          True
          {%- else -%}
          False
          {%- endif %}
        entity_id:
          - sensor.illuminance

  - platform: ping
    host: 192.168.1.126
    count: 5
    name: vera_up

## Lock Codes MQTT ###
  - platform: mqtt
    state_topic: "Vera/Events/Lock info"
    name: "Lock Parents Pin"
    value_template: '{{ value_json.Variable4 }}'
    payload_on: "On"
    payload_off: "Off"
  - platform: mqtt
    state_topic: "Vera/Events/Lock info"
    name: "Lock Temp Pin"
    value_template: '{{ value_json.Variable5 }}'
    payload_on: "On"
    payload_off: "Off"