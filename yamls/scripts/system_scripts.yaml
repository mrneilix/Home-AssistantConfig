startup_scripts:
  alias: Startup Scripts
  sequence:
    # - service: lock.lock
      # entity_id: lock.schlage_deadbolt_47
    - service: script.startup_input_booleans
    - service: script.startup_couch_colors
    - delay: 00:00:02
    - service: script.startup_presence
    - condition: template
      value_template: "{{ is_state('sensor.pi_zero_monitor_offline', 'offline') or is_state('sensor.pi_zero_monitor_offline', 'unknown') }}"
    - service: shell_command.restart_monitor

startup_presence:
  alias: Startup Presence
  sequence:
    - service_template: >
          {% if is_state('device_tracker.neil', 'home') %}
            script.startup_neil_home
          {%-elif is_state('binary_sensor.anyone_home', 'on') %}
            script.startup_neil_not_home
          {% else %}
            script.presence_no_humans_home
          {% endif %}

startup_input_booleans:
  alias: Startup Input Booleans
  sequence:
    - service_template: > 
          {%- if now().hour >= 8 and now().hour < 23 and is_state('device_tracker.neil', 'home')%}
            input_boolean.turn_on
          {% else %}
            input_boolean.turn_off
          {% endif %}
      data:
        entity_id: input_boolean.notifications_on
    - service_template: > 
          {%- if now().hour >= 8 and now().hour < 23 and is_state('device_tracker.neil', 'home') %}
            input_boolean.turn_on
          {% else %}
            input_boolean.turn_off
          {% endif %}
      data:
        entity_id: input_boolean.weather_notifications
    - service_template: > 
          {% if is_state('device_tracker.butters', 'home') %}
            input_boolean.turn_on
          {% else %}
            input_boolean.turn_off
          {% endif %}
      data:
        entity_id: input_boolean.butters_home

startup_neil_home:
  alias: Startup Neil Home
  sequence:
    - service: switch.turn_off
      entity_id: switch.yi_power
    - service_template: >
          {% if is_state('binary_sensor.dark_out', 'on') and now().hour >= 8 and now().hour < 23 %}
            script.presence_arrive_dark_out
          {% else %}
            script.do_nothing
          {% endif %}
    - service: script.thermostat_home_set_temp

startup_neil_not_home:
  alias: Startup Neil Not Home
  sequence:
    - service: switch.turn_off
      entity_id: switch.yi_power
    - service_template: >
          {% if is_state('binary_sensor.anyone_home', 'on') %}
            script.thermostat_home_set_temp
          {%-elif is_state('input_boolean.butters_home', 'off') %}
            script.thermostat_temp_everyone_away
          {% else %}
            script.thermostat_set_temp_only_butters_home
          {% endif %}

restart_homeassistant:
  alias: Restart Home Assistant
  sequence:
    - service: switch.turn_on
      entity_id: switch.yi_power
    - service: homeassistant.restart

reboot_pi_zero:
  alias: Reboot Pi Zero
  sequence:
    - service: shell_command.reboot_pi_zero

confirm_system_reboot:
  alias: Confirm System Reboot
  sequence:
    - service: notify.html5
      data:
        message: "Are you sure you want to reboot?"
        data: {
          renotify: 0,
          tag: 'reboot',
          icon: '/local/pictures/restart-ha.png',
          badge: '/local/pictures/restart-ha.png',
          actions: [
            {
              action: "confirm_system_reboot",
              title: "Yes"
            },
            {
              action: "dismiss",
              title: "Dismiss"
            },
      ]
    }

system_reboot:
  alias: Reboot System
  sequence:
    - service: switch.turn_on
      entity_id: switch.yi_power
    - delay: 00:00:02
    - service: hassio.host_reboot

startup_couch_colors:
  alias: Startup Load Couch
  sequence:
    - delay: 00:00:02
    - service: script.couch_light_update_all_controls

system_git_backup:
  alias: Startup Load Couch
  sequence:
    - service: shell_command.git_backup

system_desktop_display_off:
  alias: System Desktop Display Off
  sequence:
    - service: shell_command.desktop_screen_off
do_nothing:
  alias: Do Nothing
  sequence:
    - delay: 00:00:01