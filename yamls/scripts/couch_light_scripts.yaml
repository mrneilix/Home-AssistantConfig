couch_color_input_text:
  alias: Couch Color Input Text
  sequence:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.couch_light_script_running
    - service: input_text.set_value
      data_template:
        entity_id: input_text.couch_color
        value: '{{ color_name }}'
    - service: light.turn_on
      data_template:
        entity_id: light.couch
        color_name: '{{ color_name }}'
        brightness: 100
    - service: script.couch_light_update_input_numbers
    - delay: 00:00:01
    - service: script.couch_light_update_all_controls

couch_color_name_from_input_text:
  alias: Couch Color Name From Input Text
  sequence:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.couch_light_script_running
    - service: light.turn_on
      data_template:
        entity_id: light.couch
        color_name: '{{ states.input_text.couch_color.state }}'
        brightness: 100
    - delay: 00:00:01
    - service: script.couch_light_update_input_numbers
    - delay: 00:00:01
    - service: script.couch_light_update_all_controls

couch_color_google_voice:
  alias: Couch Color Google Voice
  sequence:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.couch_light_script_running
    - delay: 00:00:01
    - service: script.couch_light_update_input_numbers
    - delay: 00:00:01
    - service: script.couch_light_update_all_controls


couch_color_input_numbers:
  alias: Couch Colors
  sequence:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.couch_light_script_running
    - delay: 00:00:01
    - service: light.turn_on
      data_template:
        entity_id: light.couch
        rgb_color: ['{{ states.input_number.couch_r.state | int }}', '{{ states.input_number.couch_g.state | int}}', '{{ states.input_number.couch_b.state | int}}']
    - delay: 00:00:02
    - service: script.couch_light_update_all_controls

couch_light_update_all_controls:
  alias: Couch Light Update All Controls
  sequence:
    - service: script.couch_light_input_select_select_option
    - delay: 00:00:02
    - service: script.couch_light_update_input_text
    - service: script.couch_light_update_input_numbers
    - delay: 00:00:02
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.couch_light_script_running

couch_light_input_select_select_option:
  alias: Couch Light Input Select Select Option
  sequence:
    - service: input_select.select_option
      entity_id: input_select.couch_color
      data_template:
        option: >
          {% if is_state('light.couch', 'off') or is_state('light.couch', 'unavailable') or is_state('sensor.couch_light_color_name', 'Disable') %}
            Disable
          {%-elif is_state('sensor.couch_light_color_name', 'White') %}
            White
          {%-elif is_state('sensor.couch_light_color_name', 'Soft White') %}
            Soft White
          {%-elif is_state('sensor.couch_light_color_name', 'Blue') %}
            Blue
          {%-elif is_state('sensor.couch_light_color_name', 'Red') %}
            Red
          {%-elif is_state('sensor.couch_light_color_name', 'Green') %}
            Green
          {%-elif is_state('sensor.couch_light_color_name', 'Purple') %}
            Purple
          {% else %}
            Custom
          {% endif %}

couch_light_scripts_trigger:
  alias: Couch Light Scripts Trigger
  sequence:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.couch_light_script_running
    - service: script.couch_light_trigger_scene
    - delay: 00:00:01
    - service: script.couch_light_update_input_numbers
    - service: script.couch_light_update_input_text
    - delay: 00:00:02
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.couch_light_script_running

couch_light_trigger_scene:
  alias: Couch Light Trigger Scene
  sequence:
    - service: scene.turn_on
      data_template:
        entity_id: >
          {% if is_state('input_select.couch_color', 'Disable') %}
            scene.couch_turn_off
          {%-elif is_state('input_select.couch_color', 'White') %}
            scene.couch_white
          {%-elif is_state('input_select.couch_color', 'Soft White') %}
            scene.couch_soft_white
          {%-elif is_state('input_select.couch_color', 'Blue') %}
            scene.couch_blue
          {%-elif is_state('input_select.couch_color', 'Green') %}
            scene.couch_green
          {%-elif is_state('input_select.couch_color', 'Red') %}
            scene.couch_red
          {%-elif is_state('input_select.couch_color', 'Purple') %}
            scene.couch_purple
          {% else %}
            scene.couch_custom
          {% endif %}

couch_light_update_input_numbers:
  alias: Couch Light Update Input Numbers
  sequence:
    - service: input_number.set_value
      data_template:
        entity_id: input_number.couch_r
        value: '{{ states.sensor.couch_red.state | int }}'
    - service: input_number.set_value
      data_template:
        entity_id: input_number.couch_g
        value: '{{ states.sensor.couch_green.state | int }}'
    - service: input_number.set_value
      data_template:
        entity_id: input_number.couch_b
        value: '{{ states.sensor.couch_blue.state | int }}'

couch_light_update_input_text:
  alias: Couch Light Update Input Text
  sequence:
    - service: input_text.set_value
      data_template:
        entity_id: input_text.couch_color
        value: '{{ states.sensor.couch_light_color_name.state }}'

couch_group_toggle_visibility:
  alias: Couch Group Toggle Visibility
  sequence:
    - service: group.set_visibility
      data_template:
        entity_id: group.couch_light_colors
        visible: "{{ is_state('light.couch', 'on') }}"